# Grab headers & Raw URL
$headers = http.listHeaderNames();
$rawurl = http.getRawURL();

# First Check the full URI with escaped characters for the exploit and discard if matched
if( string.regexmatch( $rawurl, "(\\$|%24)(\\{|%7B).*[jJ].*[nN].*[dD].*[iI].*(:|%3A).+" )) {
      log.info( "URI " . $rawurl . " " . " Matches an Exploit" );
connection.discard();
}

foreach ($header in $headers){
#log.info( $header . ": " . http.getheader($header));

# Regex matcher for exploit
if( string.regexmatch( http.getheader($header), "(\\$|%24)(\\{|%7B).*[jJ].*[nN].*[dD].*[iI].*(:|%3A).+" )) {
   log.info( "Header " . $header . " " . http.getheader($header) . " Matches an Exploit" );
 
# Comment next line out for detect and log only  
   connection.discard();
}
}
