# Version 1.2 - 2021-12-13 GMT 14:32
# - Added POST/PUT method payload check
  # NOTE $body = http.getBody(1048576); Amend this to the max payload you wish to compare in Bytes
# Version 1.2- 2021-12-13 GMT 11:08
# - Added URI checker
# Version 1.0 - 2021-12-11 06:10 GMT
# - Initial release

$headers = http.listHeaderNames();
$rawurl = http.getRawURL();
$regex = "(\\$|%24)(\\{|%7B).*[jJ].*[nN].*[dD].*[iI].*(:|%3A).+";
$body = http.getBody(1048576);

# URL Matcher
if( string.regexmatch( $rawurl, $regex )) {
  log.info( "URI " . $rawurl . " " . " Matches an Exploit" );
  connection.discard();
}

# Payload Matcher POST and PUT
if( http.getMethod() == "POST" || http.getMethod() == "PUT" ) {  
  if( string.regexmatch( $body, $regex )) {   
    log.info( "Body " . $body . " " . " Matches an Exploit" );   
    connection.discard();  
  }
}

# Header Matcher
foreach ($header in $headers){
  #log.info( $header . ": " . http.getheader($header));
  if( string.regexmatch( http.getheader($header), $regex )) {
    log.info( "Header " . $header . " " . http.getheader($header) . " Matches an Exploit" );
    connection.discard();
 }
}
